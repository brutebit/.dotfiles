
* Example Usage

** NixOS

#+BEGIN_SRC nix
  {
    description = "Personal NixOS Configuration";

    inputs = {
      nixpkgs.url = "nixpkgs/nixos-unstable";
      home-manager = {
        url = "github:nix-community/home-manager";
        inputs.nixpkgs.follows = "nixpkgs";
      };
      emacs-conf = {
        url = "github:ehadx/dotfiles?dir=emacs";
        inputs.nixpkgs.follows = "nixpkgs";
      };
      gnome-conf = {
        url = "github:ehadx/dotfiles?dir=gnome";
        inputs.nixpkgs.follows = "nixpkgs";
      };
      nvim-conf = {
        url = "github:ehadx/dotfiles?dir=nvim";
        inputs.nixpkgs.follows = "nixpkgs";
      };
      system-mods = {
        url = "github:ehadx/dotfiles?dir=system";
        inputs.nixpkgs.follows = "nixpkgs";
      };
    };

    outputs = { nixpkgs, home-manager, emacs-conf, gnome-conf, nvim-conf, system-mods, ... }:
      let
        system = "x86_64-linux";
        lib = nixpkgs.lib;
        pkgs = nixpkgs.legacyPackages.${system};
      in {
        nixosConfigurations = {
          machinehostname = lib.nixosSystem {
            inherit system;
            modules = [
              ./hardware-configuration.nix
              ./some-machine-special-module.nix
              system-mods.modules.shared
              system-mods.modules.linux
              system-mods.modules.nvidia
              system-mods.modules.containers
              gnome-conf.system-conf
              emacs-conf.system-conf
              nvim-conf.system-conf

              home-manager.nixosModules.home-manager {
                home-manager.useGlobalPkgs = true;
                home-manager.useUserPackages = true;
                home-manager.extraSpecialArgs = {
                  emacs-conf = emacs-conf.home-conf;
                  gnome-conf = gnome-conf.home-conf;
                  nvim-conf = nvim-conf.home-conf;
                };
                home-manager.users.yourusername = ({ config, pkgs, emacs-conf, gnome-conf, nvim-conf, ... }: {
                  imports = [
                    ({ config, pkgs, ... }: {
                      home.username = "yourusername";
                      home.homeDirectory = "/home/yourusername";
                      home.stateVersion = "24.05"; # depends on homemanager version

                      home.packages = [
                        pkgs.direnv
                        pkgs.nix-direnv
                      ];

                      home.sessionVariables = {
                        EDITOR = "emacs";
                      };

                      # Let Home Manager install and manage itself.
                      programs.home-manager.enable = true;

                      programs.git = {
                        enable = true;
                        userName = "githubusername";
                        userEmail = "useremail@gmail.com";
                      };
                    })
                    emacs-conf
                    gnome-conf
                    nvim-conf
                  ];
                });
              }
            ];
          };
        };
      };
  }
#+END_SRC
